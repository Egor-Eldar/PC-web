# PC-web
    #Система доменных имён DNS
    
  DNS (Domain Name System) —  это протокол для разрешения доменных имён.
Протокол предназначен для связывания названия доменов с IP-адресами компьютеров, соответствующих этим доменам, а также для получения информации о маршрутизации почты, обслуживающих узлах для протоколов в домене (SRV запись).
Протокол DNS использует порт 53.
Историческая справка:
Систему доменных имен разработал в 1983 году Пол Мокапетрис, во время проекта ARPANET, инициированного Пентагоном. Тогда же было проведено первое успешное тестирование DNS, ставшей позже одним из базовых компонентов сети Internet. С помощью DNS стало возможным реализовать масштабируемый распределенный механизм, устанавливающий соответствие между иерархическими именами сайтов и числовыми IP-адресами. Рост Internet становился лавинообразным. К сети, возникшей на основе проекта ARPANET, инициированного Пентагоном, присоединялись все новые и новые компании и исследовательские институты.
Предложенное Мокапетрисом решение DNS  представляло собой распределенную базу данных, которая позволяла организациям, присоединившимся к Internet, получить свой домен.
С 1986 года начался массовый переход на использование DNS.
    ##Характеристики системы DNS в глобальной сети Интернет
Распределённость администрирования
Распределённость хранения информации
Кеширование информации
Иерархическая структура
Резервирование


    ##Механизмы разрешения имён
Локальный для каждого компьютера файл hosts.
Централизованная иерархическая служба имен DNS.
Файл hosts — это текстовый документ, который содержит в себе информацию о домене и IP-адресе, который ему соответствует. Располагается hosts на локальных машинах.
С помощью этого файла вы можете управлять маршрутизацией трафика и разрешением IP-адресов в имена DNS. Приоритет данного файла позволяет обрабатывать сетевые запросы до их передачи публичным или частным DNS-серверам.
На начальном этапе развития сетей, когда количество узлов в каждой сети было небольшое, достаточно было на каждом компьютере хранить и поддерживать актуальное состояние простого текстового файла, в котором содержался список сетевых узлов данной сети. Список устроен очень просто - в каждой строке текстового файла содержится пара "IP-адрес - имя сетевого узла".
Сразу после установки операционной системы файл hosts создаётся с одной записью 127.0.0.1 localhost.
Местонахождение файла hosts:
В Linux: /etc/hosts
В Windows: %system root%\system32\drivers\etc\hosts (где %system root% обозначает папку, в которой установлена операционная система).
С ростом сетей поддерживать актуальность и точность информации в файле hosts становится все труднее. Для этого надо постоянно обновлять содержимое этого файла на всех узлах сети. Кроме того, такая простая технология не позволяет организовать пространство имен в какую-либо структуру. Поэтому появилась необходимость в централизованной базе данных имен, позволяющей производить преобразование имен в IP-адреса без хранения списка соответствия на каждом компьютере. Такой базой стала DNS (Domain Name System) - система именования доменов, которая начала массовую работу в 1987 году.
С появлением службы DNS актуальность использования файла host совсем не исчезла, в ряде случаев использование этого файла оказывается очень эффективным.
Системный вызов разрешения имён во всех ОС обычно реализован так: сначала проверяется локальный файл hosts, затем идёт обращение в службу имён DNS, прописанную локальных настройках ОС:
В Linux — в файле /etc/resolv.conf
В Windows — настройки адаптера→DNS→DNS серверы и DNS суффиксы.
 
    ##Служба DNS и пространство имён DNS
Служба DNS - это иерархическая база данных, сопоставляющая имена сетевых узлов и их сетевых служб IP-адресам узлов. В основе иерархической структуры базы данных DNS лежит доменное пространство имен (domain namespace), основной структурной единицей которого является домен, объединяющий сетевые узлы (хосты), а также поддомены. Процесс поиска в БД службы DNS имени некоего сетевого узла и сопоставления этому имени IP-адреса называется "разрешением имени узла в пространстве имен DNS".
Прямое разрешение имён: преобразование символьных имён в IP-адреса (например, server.com в 10.0.2.5).
Обратное разрешение имён: преобразование IP-адреса в символьное имя (например, 10.0.2.5 в server.com).
Пространство имен DNS - иерархическая древовидная структура, начинающаяся с корня, не имеющего имени и обозначаемого точкой ".". Для обратного разрешения используется специальная зона с заререзвированным именем "in-addr.arpa", при этом имена в домене "in-addr.arpa" образуют иерархию цифр, которые соответствуют IP-адресам.
Схему построения пространства имен DNS лучше всего проиллюстрировать на примере:
Реализации службы DNS:
BIND (Berkeley Internet Name Domain).
Microsoft DNS Server

  Пример файла «example.com» зоны прямого разрешения:
@ IN SOA ns.example.com. root.example.com. (
95031802 ; Serial (yymmddxx)
10800 ; Refresh 3 hours
3600 ; Retry 1 hour
3600000 ; Expire 1000 hours
86400 ) ; Minimum 24 hours
@ IN NS ns.example.com.
@ IN NS ns2.example.com.
@ IN A 10.0.0.152
@ IN MX 5 mx.example.com.
ns IN A 10.0.0.152
ns2 IN A 10.0.0.191
mx IN A 10.0.0.152
www IN CNAME @
  Пример файла "0.0.10.in-addr.arpa" зоны обратного разрешения:
@ IN SOA ns.examle.com. root.example.com. (
94102501 ; Serial
10800 ; Refresh 3 hours
3600 ; Retry 1 hour
3600000 ; Expire 1000 hours
86400 ) ; Minimum 24 hours
IN NS ns.examle.com.
IN NS ns2.example.com.
152 IN PTR example.com.
191 IN PTR ns.example.com.
* IN PTR example.com.
  Пример подключения файлов зон (на примере BIND):
// подключение основной зоны
zone "example.com" {
type master;
file "example.com";
};
// подключение обратной зоны
zone "0.0.10.in-addr.arpa" {
type master;
file "0.0.10.in-addr.arpa";
};
    ##Формат SOA-записи
Primary Name Server: Имя первичного DNS-сервера зоны
Hostmaster: Контактный адрес лица, ответственного за администрирование файла зоны. Обратите внимание на то, что вместо «@» используется «.»
Serial number: Серийный номер файла зоны. 32-разрядное целое число, меняющееся при каждом обновлении зоны.
Refresh: Время (в секундах) ожидания вторичного DNS перед запросом SOA-записи с первичного. По истечении данного времени, вторичный DNS обращается к первичному, для получения копии текущей SOA-записи. Первичный DNS-сервер выполняет этот запрос. Вторичный DNS-сервер сравнивает полученный серийный номер зоны с имеющимся. Если они отличаются, то осуществляется запрос к первичному DNS-серверу на трансфер зоны.
Retry: Время в секундах, вступает в действие тогда, когда первичный DNS-сервер недоступен. Интервал времени, по истечении которого вторичный DNS должен повторить попытку синхронизировать описание зоны с первичным.
Expire: Время (в секундах), в течение которого вторичный DNS будет пытаться завершить синхронизацию зоны с первичным. Если это время истечет до того, как синхронизация осуществляется, зона на вторичном DNS-сервере истечет, и он перестанет обслуживать запросы об этой зоне.
Minimum TTL: Минимальное время жизни, применяемое ко всем ресурсным записям зоны. Это значение применяется в ответах на запросы с целью проинформировать остальные серверы, сколько времени они могут хранить данные в кэше.
Пример настройки сервера Bind:

 
    ##Режимы работы DNS сервера (на примере BIND)
1. Кэширующий. Обрабатывает рекурсивные запросы, выполняет на ROOT серверах (файл /etc/root.hint). Необходима защита от DoS-атак.
Пример настройки:
acl goodclients { 192.0.2.0/24; localhost; localnets; };
options {
  recursion yes;
  allow-query { goodclients; };
};
2. Перенаправляющий. Перенаправляет все запросы на другие DNS-сервера, не пытаясь решить их, затем их кэширует. Меньше рабочая нагрузка.
Список серверов прописывается явно (пример настройки сервера BIND):
forwarders { 8.8.8.8; 8.8.4.4;};
options {
  forward only;
};
3. Авторитетный (первичный — master).
Пример подключения зоны прямого разрешения на первичном сервере (master) 10.0.0.152 с разрешением обмена со вторичным (slave) сервером 10.0.0.191:
zone "example.com" {
  type master;
  file "example.com";
  allow-transfer { 10.0.0.191; };
};
4. Авторитетный (вторичный — slave).
Пример подключения зоны прямого разрешения на вторичном (slave) сервере 10.0.0.191 с импортом этой зоныzone "example.com" {
  type slave;
  file "example.com";
  masters { 10.0.0.152; };
};
 из первичного (master) сервера 10.0.0.152:
 
 
    ##Транзакции DNS
Запросы и ответы.
Динамическое обновление. DHCP-сервер удаляет данную ресурсную запись с типом A после того, как IP-адрес возвращается хостом.
Зонные пересылки. Вторичный (slave) сервер обновляет все содержимое своего зонного файла от первичного (master) сервера  в ответ на сообщение DNS NOTIFY, либо основываясь на значении элемента данных Refresh в поле Start of Authority (SOA) ресурсной записи.
DNS NOTIFY. Всякий раз, когда выполняются изменения в зонном файле первичного (master) DNS-сервера, вторичные (slave) DNS-серверы, которые содержат идентичные данные, должны быть уведомлены об изменениях. Такое уведомление выполняется посредством сообщения DNS NOTIFY, которое указывает, что вторичному DNS-серверу следует начать зонную пересылку.
    ##Типы запросов к DNS
Рекурсивный и нерекурсивный. При рекурсивном выполняется от имени клиента полный поиск нужной информации во всей системе DNS, при необходимости обращаясь к другим DNS-серверам.
Прямой и обратный DNS-запрос.
 
    ##Утилиты для обращения к системе DNS
В Windows:
nslookup <имя или ip> [<DNS-сервер>]
В Linux:
host  {name} [server]
dig [@server] [name] [type]
 



 
    ##Протокол динамической конфигурации сетевых устройств DHCP
 
DHCP (Dynamic Host Configuration Protocol) — это протокол динамической конфигурации сетевых устройств.
Протокол предназначен для автоматического получения IP-адреса и других параметров, необходимых для работы сетевых устройств в локальной вычислительной сети.
Протокол DHCP на сервере использует порт 67, на клиенте - 68.
Для работы протокола используется широковещание broadcast в пределах текущей подсети
(широковещательным доменом). Для взаимодействия с клиентами расположенными в других подсетях использоваться агенты ретрансляции (DHCP Relay).
DHCP является расширением протокола BOOTP, использовавшегося для обеспечения бездисковых рабочих станций IP-адресами.
Протокол используется для упрощения администрирования сети за счет использования специально настроенного сервера для централизованной раздачи IP-адресов и других параметров сетевым устройствам.
Историческая справка:
Стандарт протокола DHCP был принят в 1993 году. Действующая версия протокола описана в RFC 2131. Новая версия DHCP, предназначенная для использования в среде IPv6, носит название DHCPv6 и определена в RFC 3315 (2003 г.).
      ##Параметры, получаемые по DHCP
IP-адрес. Маска подсети.
Шлюзы по умолчанию.
Статические маршруты.
DNS-серверы.
Сервер синхронизации времени.
Смещение времени.
Настройки сервера загрузки – настройки протокола TFTP/BOOTP, необходимые для бездисковой загрузки хостов.
Списки доступных SMTP и POP серверов.
Настройки WINS и Netbios
Размер MTU, время жизни кэша ARP, размер TTL и др.
Алгоритм получения сетевых настроек через DHCP-сервер

1. Клиент посылает в свою подсеть широковещательное сообщение DHCPDISCOVER, в котором могут указываться устраивающие клиента IP-адрес и срок его аренды. В качестве IP-адреса источника указывается 0.0.0.0, в качестве адреса назначения - 255.255.255.255. Если DHCP-сервер отсутствует в подсети, то сообщение будет передано в другие подсети агентами протокола BOOTP.
2. Получив запрос от клиента, DHCP-сервер отвечает на него сообщением DHCPOFFER. В сообщение включается предлагаемый IP-адрес (yiaddr) и прочие конфигурации для клиента (адреса маршрутизаторов, DNS-серверов и т.д.). На данном этапе сервер не обязан резервировать адрес, который он отправил клиенту.
3. Получив конфигурации от серверов (их может быть несколько, если в подсети более одного DHCP-севрера), клиент отправляет широковещательное сообщение DHCPREQUEST. В нем содержатся идентификатор выбранного сервера и, возможно, желательные значения запрашиваемых параметров конфигурации. На данном этапе допускается, что клиента не устроит ни один из предложенных адресов, тогда он вновь отправит DHCPDISCOVER.
4. Получив DHCPREQUEST и убедившись, что в сообщении его идентификатор, сервер проверяет свободен ли в данный момент запрошенный адрес. Если да, то отправляет DHCPACK и вносит запись в базу, иначе отправляет DHCPNACK.
5. Получив сообщение DHCPACK, клиент обязан убедиться в уникальности IP-адреса (средствами протокола ARP) и зафиксировать суммарный срок его аренды.
Срок аренды: время, прошедшее между отправкой сообщения DHCPREQUEST и приемом ответного сообщения DHCPACK + срок аренды, указанный в DHCPACK.
Если адрес уже используется другой станцией, клиент отправляет DHCPDECLINE и начинает всю процедуру снова.
6. Для досрочного прекращения аренды адреса клиент отправляет серверу сообщение DHCPRELEASE.


 
    Цель
Настроить DNS-сервер на примере пакета Bind из состава операционной системы Debian или Ubuntu:

Начальные условия: необходимо создать виртуальную машину (ВМ) локально в VirtualBox. Для этого скачать образ Debian 11 и импортировать в VirtualBox. После импорта сделать снапшот с именем Clean.
Для входа в локальную систему VirtualBox необходимо использовать учётные данные:
username: root
password: P@ssw0rd
Также есть вариант для выполнения этой практической работы на облачных платформах Oracle Cloud или AWS. Создание облачных серверов описано в первом модуле.
 
 
 
 
 
 


